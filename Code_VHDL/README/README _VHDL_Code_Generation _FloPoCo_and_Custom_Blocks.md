# VHDL Generation Automation Script

## 🎯 Objective

This script automates the generation of **synthesizable VHDL files** for both:

- Custom-designed blocks (**my own implementation**)  
- Blocks generated by **FloPoCo**  

---

## 📂 Directory Structure

```
project/
├── generate_vhdl.py          ← Python script to launch generation
├── template/                 ← Contains VHDL template files
│   ├── top_add_template.vhd
│   ├── top_mult_template.vhd
│   ├── top_mac_template.vhd
│   ├── top_flopoco_fpadd_template.vhd
│   ├── top_flopoco_fpmult_template.vhd
│   └── top_flopoco_fpmac_template.vhd
└── vhdl_files/
    ├── my_code/              ← My custom VHDL top-level designs
    │   ├── top_Add_Test.vhd
    │   ├── top_Mult_Test.vhd
    │   └── top_MAC_Test.vhd
    └── flopoco/              ← FloPoCo VHDL + integrated top-levels
        ├── top_FPAdd_Test.vhd
        ├── top_FPMult_Test.vhd
        └── top_FPMAC_Test.vhd
```

---

## ⚠️ How to Generate Files

From the `project/` directory, run:

- **For personal code**:
```bash
python3 generate_vhdl.py MYCODE
```

- **For FloPoCo code**:
```bash
python3 generate_vhdl.py FLOPOCO <frequency_value>
```

**Examples:**
```bash
python3 generate_vhdl.py MYCODE       # For my code
python3 generate_vhdl.py FLOPOCO 300  # For FloPoCo
```

---

## ⚠️ Script Tasks

### 1️⃣ FloPoCo Blocks

- Calls FloPoCo using command line (e.g., `flopoco IEEEFPAdd ...`)  
- Moves the generated `flopoco.vhdl` into a build directory  
- Merges the generated code with a VHDL top-level template  
- Saves the full file into:  
```
vhdl_files/flopoco/top_<Component>_Test.vhd
```

### 2️⃣ Custom Blocks

- Loads your **custom top-level template**  
- Replaces placeholders (e.g., `{{ENTITY_NAME}}`, `{{EXP_WIDTH}}`, etc.)  
- Saves the result into:  
```
vhdl_files/my_code/top_<Block>_Test.vhd
```

---

## ⚙️ Parameters

Inside `generate_vhdl.py`, you can customize each block like this:

**Example for custom blocks:**
```json
{
  "name": "Add",
  "template": "top_add_template.vhd",
  "exp_width": 5,
  "mant_width": 10,
  "DECAL": 29
}
```

**Example for FloPoCo blocks:**
```json
{
  "component": "FPMAC",
  "template": "top_flopoco_fpmac_template.vhd",
  "flopoco_cmd": "IEEEFPFMA",
  "exp_width": 5,
  "mant_width": 10,
  "name": "FPMAC16"
}
```

---

## ⚠️ Important Notes

- Change **only** the `exp_width` and `mant_width` parameters.  
- For the parameter `DECAL`:
  - Float16 → keep it at **29**  
  - Float32 → **253**  
  - Bfloat → **253**  
  - Double → **2045**
